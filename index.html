<!DOCTYPE html>
<html>
  <head>
    <!-- <link href="https://file.myfontastic.com/n6vo44Re5QaWo8oCKShBs7/icons.css" rel="stylesheet"> -->

    <!-- bootstrap icons -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- font awesome icons -->
    <link rel="stylesheet" href="css/font-awesome-4.6.3/css/font-awesome.min.css">
    
    <!-- google web fonts -->
    <!-- <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"> -->

    <!-- bower:css -->
    <!-- <link rel="stylesheet" href="/content/themes/jhu_id/bower_components/normalize-css/normalize.css"> -->
    <link rel="stylesheet" href="fonts/gentona/gentona.css">
    <link rel="stylesheet" href="fonts/titling-gothic/titling-gothic.css">
    <link rel="stylesheet" href="fonts/quadon/quadon.css">
    <link rel="stylesheet" href="fonts/arnhem/arnhem.css">
    <!-- endbower -->

    <title>FlashR Intro</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <style type="text/css">
      /*@import url(https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);*/
      /*@import url(https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic);*/
      /*@import url(https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);*/
      /*@import url(http://fonts.googleapis.com/css?family=Varela+Round:regular,italic,bold,bolditalic);*/
      /*@import url(http://fonts.googleapis.com/css?family=Raleway:regular,italic,bold,bolditalic);*/

      body {
        font-family: 'gentona'; /* Varela Round */
        font-size: 1.6em;
      }
      /*      h1, h2, h3, h4, h5, h6 {
        font-family: 'quadon';
      }      */
      h1, h2, h3, h4, h5, h6 {
        font-family: 'quadon';
        font-weight: 400;
        margin-bottom: 0;
        color: #d5ad6d;
/*        color:  #D5AD6D; /*if no support for background-clip*/
  
        /*background: -webkit-linear-gradient(transparent, transparent),*/
             /*-webkit-linear-gradient(top, rgba(213,173,109,1) 0%, rgba(213,173,109,1) 26%, rgba(226,186,120,1) 35%, rgba(163,126,67,1) 45%, rgba(145,112,59,1) 61%, rgba(213,173,109,1) 100%);*/
        /*background: -o-linear-gradient(transparent, transparent);*/
  /*-webkit-background-clip: text;*/
  /*-webkit-text-fill-color: transparent;*/

      }
      .remark-slide-content {
        font-size: 1.5em;
        background: #272822;
        background: radial-gradient(circle, #272822, #15120e, black); /* Standard syntax */
        background: -webkit-radial-gradient(circle, #272822, #15120e, black); /* Safari */
        background: -o-radial-gradient(circle, #272822, #15120e, black); /* Opera 11.6 to 12.0 */
        background: -moz-radial-gradient(circle, #272822, #15120e, black); /* Firefox 3.6 to 15 */
        background: radial-gradient(circle, #272822, #15120e, black); /* Standard syntax */

        color: #ebd8b9; /*#f4e9d8;*/ /*#debe8b;*/ /*#6dd5ad;*/ /*rgba(213,173,109,1);*/ /*rgba(163,126,67,1);*/ /*rgba(226,186,120,1);*/ /*rgba(213,173,109,1);*/ /*#6dd5ad;*/
        /*background: #3B263C;*/
  /*        color:  #FFFF00; /*#DDA0DD;*/  /*#A565D6;*/ /* #DF9BFF;*/ /*#FFFF00;*/*/
      }

      h1, h2, h3, h4 {
        text-align: center;
        /*text-shadow: 2px 2px gray; /*#ff0000;*/*/
      }

      .remark-slide-content h1 { font-size: 3em; }
      .remark-slide-content h2 { font-size: 2em; }
      .remark-slide-content h3 { font-size: 1.6em; }
      .remark-slide-content h4 { font-size: 1.4em; }
      .footnote {
        position: absolute;
        bottom: 3em;
      }
      .navbar {
        position: absolute;
        float: center;
        top: 0em;
        font-family: 'titling-gothic';  /* Yanone Kaffeesatz */
        font-weight: 200;
        color: #A7A7A7;
      }
      .navbar a {
        color: #A7A7A7;
      }
      .bbar {
        position: absolute;
        bottom: 13px;
        left: 13px;
        font-family: 'titling-gothic';  /* Yanone Kaffeesatz */
        font-weight: 200;
        color: #A7A7A7;
      }
      .bbar a {
        color: #A7A7A7;
      }
      .cbar {
        position: absolute;
        bottom: 13px;
        left: 13px;
        font-family: 'titling-gothic';  /* Yanone Kaffeesatz */
        font-weight: 200;
        /*color: #A7A7A7;*/
        color: #bdbcbc;
      }
      .cbar a{
       color: #bdbcbc; 
      }

      .btn {
        background: #424242;
        height: 2em;
      }
      li p { line-height: 1.25em; }
      .r { color: #fa0000; }
      .w {color: white;}
      .ye { color: #FFFF00; }
      .y { color: #fcfaf6; }
      .pink { color: #FF87F3;}
      .orange { color: #FFA500;}
      .g { color: #00CC00; }
      .blue { color: #75E9FF;}
      .purple { color: #A149A9;}
      .large { font-size: 2em; }
      .black { color: black; background-color: white;}
      a, a > code {
        color:  rgb(249, 38, 114); 
        color: white; 
        color: #bdbcbc; 
        /*color: #b1b1b1;*/
        text-decoration: none; /*underline*/
      }

      a:hover {
        color: white;
      }


      code {
        background: #424242;
        border-radius: 5px;
      }
      .remark-code, .remark-inline-code { font-family: 'Ubuntu Mono'; }
      .remark-code-line-highlighted     { background-color: #373832; }
/*      .pull-left {
        float: left;
        width: 47%;
      }*/
      .pull-left {
        float: left;
        width: 47%;
      }
      .pull-right {
        float: right;
        width: 47%;
      }
      .center {
        margin: auto;
        width: 100%;
        padding: 10px;
      }
      .small {
        font-size: 0.8em;
      }
/*      .pull-right {
        float: right;
        width: 47%;
      }*/
      .pull-bottom {
        position: absolute;
        bottom: 0;
      }
      .bottom {
        position: absolute;
        bottom: 35px;
        left: 13px;
        font-family: 'Yanone Kaffeesatz';
      }
      .pull-right ~ p {
        clear: both;
      }
      #slideshow .slide .content code {
        font-size: 0.8em;
      }
      #slideshow .slide .content pre code {
        font-size: 0.9em;
        padding: 15px;
      }
      .inverse {
        background: white;
        color: white;
        text-shadow: 0 0 20px #333;
      }
      .inverse p {
        color: white;
      }
      .inverse h1, .inverse h2 {
        color: #f3f3f3;
        line-height: 0.8em;
      }
      #frame { zoom: 0.75; -moz-transform: scale(0.75); -moz-transform-origin: 0 0; }

      /* Slide-specific styling */
      #slide-inverse .footnote {
        bottom: 12px;
        left: 20px;
      }
      #slide-how .slides {
        font-size: 0.9em;
        position: absolute;
        top:  151px;
        right: 140px;
      }
      #slide-how .slides h3 {
        margin-top: 0.2em;
      }
      #slide-how .slides .first, #slide-how .slides .second {
        padding: 1px 20px;
        height: 90px;
        width: 120px;
        -moz-box-shadow: 0 0 10px #777;
        -webkit-box-shadow: 0 0 10px #777;
        box-shadow: 0 0 10px #777;
      }
      #slide-how .slides .first {
        background: #fff;
        position: absolute;
        top: 20%;
        left: 20%;
        z-index: 1;
      }
      #slide-how .slides .second {
        position: relative;
        background: #fff;
        z-index: 0;
      }

      /* Two-column layout */
      .left-column {
        color: #777;
        width: 20%;
        height: 92%;
        float: left;
      }
      .left-column h2:last-of-type, .left-column h3:last-child {
        color: #000;
      }
      .right-column {
        width: 75%;
        float: right;
        padding-top: 1em;
      }
      br {
        line-height: 50%;
      }
      .task {
        float: right;
        font-size: 0.9em;
        padding-top: 0.6em;
      }

  }
    </style>
  </head>
  <body onload="var slideshow = remark.create();">
    <textarea id="source">



class: center, middle

name:opening

# [FlashR](http://flashx.io/):
### Enable Parallel, Scalable Data Analysis in R

<br>
<!-- [prof joshua t. vogelstein](http://jovo.me) -->

<br>

.center[
**Da Zheng**, Joshua T. Vogelstein, Disa Mhembere, Carey E. Priebe, Randal Burns
<br>
Johns Hopkins University
<br>
]

---

# Goals of FlashR

<br>

- Productivity: high-level programming interface to write data analysis algorithms easily.
- Generality: express varieties of data analysis algorithms.
- Scalability: process at least terabytes of data.
- Computation efficiency: comparable to parallel C code.

---

# Motivation

<br>

- Big data & data science
  - Large data volumn: terabytes or petabytes
  - Complex data analysis: statistics & machine learning

- Statistics & machine learning
  - High scalability
  - High computation efficiency
  - High programming productivity

---

# Motivation

<br>

- Dilemma 1
  - High efficiency + high scalability => low-level programming languages (C/C++).
  - C/C++ => low programming productivity.

- Dilemma 2
  - Few system programmers know statistics and machine learning well.
  - Few statisticians and data scientists know C/C++ or parallel programming well.

---

class: middle

.center[
## An ideal solution:
### Domain experts: focus on algorithm design and implementation in a familiar framework.
### System programmers: focus on making the framework run faster.
]
<!-- ## Do we have to write parallel C/C++ code to achieve extreme efficiency and scalability? -->


---

## The FlashR realization

<br>

.center[
<img src="images/FlashR-sol.png" alt="Drawing" style="width: 700px;"></iframe>
]


---

### Challenge #1: achieve generality, efficiency and productivity together.

<br>

.center[
<img src="images/challenge1.png" alt="Drawing" style="width: 700px;"></iframe>
]

---

### Challenge #1: achieve generality, efficiency and productivity together.

<br>

.center[
<img src="images/challenge1-2.png" alt="Drawing" style="width: 700px;"></iframe>
]

---

## GenOps + VUDFs

<br>

- Generalized matrix operations (GenOps).
- Vectorized functions (VUDFs) to operate on matrix elements.

.center[
<img src="images/API.png" alt="Drawing" style="width: 400px;"></iframe>
]

---

### Challenge #2: reduce data movement.

<br>

.pull-left[
- Speed gap between every pair of levels is large.
- Speed gap continues increasing in the past decades.
]

.pull-right[
<img src="images/mem-arch.png" alt="Drawing" style="width: 300px;"></iframe>
]

---

## Lazy evaluation + 2-level partitioning

<br>

.pull-left[
<img src="images/DAG.png" alt="Drawing" style="width: 250px;"></iframe>
]
.pull-right[
<img src="images/materialize.png" alt="Drawing" style="width: 180px;"></iframe>
]

---

## R base package

<br>

- FlashR provides implementations of many matrix operations in the R base package with generalized matrix operations.

.pull-left[
R:
- +, -, *, /, %*%, ==, !=, >, >=, <, <=
- sum, mean, min, max
- abs, sqrt, ceiling, floor, round, log,
- rowSums, colSums, rowMeans, colMeans
]

.pull-right[
FlashR (Base API):
- +, -, *, /, %*%, ==, !=, >, >=, <, <=
- sum, mean, min, max
- abs, sqrt, ceiling, floor, round, log,
- rowSums, colSums, rowMeans, colMeans

FlashR (Advanced API):
- fm.sum, fm.min, fm.max, fm.rowSums, fm.colSums
]

---

## Parallelized correlation with 7 lines of native R code

<br>

```R
corr <- function(D) {
	n <- nrow(D)
	D.sum <- rowSums(t(D))
	D2.sum <- rowSums(t(D * D))
	D.prod <- t(D) %*% D
	D.mu <- D.sum / n
	D.sd <- sqrt((D2.sum - n * D.mu * D.mu) / (n - 1))
	ret <- (D.prod - n * D.mu %*% t(D.mu)) / (n - 1) / (D.sd %*% t(D.sd))
}
```

---

## Parallelized k-means with 8 lines of FlashR code

<br>

```R
kmeans.iter <- function(X, C){
	D <- fm.inner.prod(X, t(C), "euclidean", "+")
	I <- fm.agg.row(D, "which.min")
	one <- fm.rep.int(1, nrow(I))
	CNT <- fm.groupby.row(one, I, "+")
	C <- fm.groupby.row(X, I, "+")
	C <- fm.mapply.row(C, CNT, "/")
	list(C=C, I=I)
}
```

---

### FlashR outperforms C/FORTRAN code in R with a single thread

<br>

.center[
<img src="images/FlashR.vs.R.png" alt="Drawing" style="width: 700px;"></iframe>
]

Dataset: 65M samples and 32 features; under a mixture of Gaussian

---

### FlashR outperforms Spark Mllib by almost an order of magnitude

<br>

.center[
<img src="images/FlashR.vs.Spark.png" alt="Drawing" style="width: 700px;"></iframe>
]

Dataset: 1B samples and 32 features; under a mixture of Gaussian

---

### EM execution of FlashR has little memory consumption

<br>

.center[
<img src="images/FlashR.vs.Spark.mem.png" alt="Drawing" style="width: 700px;"></iframe>
]

Dataset: 1B samples and 32 features; under a mixture of Gaussian

---

# Summary

<br>

- FlashR is a scalable, efficient programming framework for data analysis.
- Next steps:
  - Upload FlashR to CRAN.
  - Support other R data structures (e.g., data frame).
  - Extend a machine learning library.

---

# Thank you!

<br>

- FlashX: http://flashx.io/
- Get source code: https://github.com/zheng-da/FlashX.git
- Email: dzheng5@jhu.edu
- Acknowledgements: This work is graciously supported by DARPA SIMPLEX.

<!-- ____ -->


<!-- [more slides](http://docs.neurodata.io/ndintro/more.html) -->





    </textarea>
    <script src="remark-latest.min.js" type="text/javascript">
    </script>
    <script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML&delayStartupUntil=configured" type="text/javascript"></script>
    <script type="text/javascript">
      var slideshow = remark.create();

      // Setup MathJax
      MathJax.Hub.Config({
          tex2jax: {
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
          }
      });
      MathJax.Hub.Queue(function() {
          $(MathJax.Hub.getAllJax()).map(function(index, elem) {
              return(elem.SourceElement());
          }).parent().addClass('has-jax');
      });

      MathJax.Hub.Configured();

var slideshow = remark.create({
  // Set the slideshow display ratio
  // Default: '4:3'
  // Alternatives: '16:9', ...
  ratio: '4:3',

  // Navigation options
  navigation: {
    // Enable or disable navigating using scroll
    // Default: true
    // Alternatives: false
    scroll: true,

    // Enable or disable navigation using touch
    // Default: true
    // Alternatives: false
    touch: true,

    // Enable or disable navigation using click
    // Default: false
    // Alternatives: true
    click: false
  },

  // Customize slide number label, either using a format string..
  // slideNumberFormat: 'Slide %current% of %total%',
  // .. or by using a format function
  slideNumberFormat: function (current, total) {
    return  current + ' of ' + total;
  },

  // Enable or disable counting of incremental slides in the slide counting
  countIncrementalSlides: false,

  highlightLanguage: 'R',
  highlightStyle: 'monokai',
  highlightLines: true,
}); 

    </script>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
  </body>
</html>
